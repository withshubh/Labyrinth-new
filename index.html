<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Labyrinth game — A-Frame</title>
    <meta name="description" content="Labyrinth — A-Frame">
    <!--Libraries & external scripts Import-->
    <script src="libs/aframe.js"></script>
    <script src="libs/aframe-extras.js"></script>
    <script src="libs/aframe-text-component.min.js"></script>
    <script src="libs/lz-string.min.js"></script>
    
    <script src="src/common.js"></script>

  </head>

  <body>
    <!--Aframe scene starts here-->
    <a-scene fog="type: linear; color: #AAB; near: 0; far:10;" physics id="scene" >
      <!--Importing Assets-->
      <a-assets>
        <img src="assets/door.png" id="door">
        <img src="assets/wall.jpg" id="asset_wall">
        <img src="assets/roof.jpg" id="asset_roof">
        <img src="assets/ground.jpg" id="asset_ground">
        <img src="assets/instruction.jpg" id="asset_instruction">
        <img src="assets/reload.png" id="asset_reload">
      </a-assets>
      <!--Entity to add background noise-->
      <a-entity sound="src: url(assets/backgroundnoise.mp3); autoplay: true; loop:true; distanceModel:linear">
      </a-entity>
      <!--Camera/Player body Entity-->
      <a-entity static-body
                sound="src: url(src/bat.mp3); on: collide; volume:0.1;"
                velocity="0 0 0" 
                rotation="0 0 0" 
                position="0 1.6 -2" 
                id="camera" 
                camera="" 
                kinematic-body 
                universal-controls>
                <!--Entity to create a round crosshair at the center of the scene-->
                <a-entity cursor="fuse: true; fuseTimeout: 500"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color:green; shader: flat">
                </a-entity>
                <!--Entity for Timer-->
                  <a-entity text="text: Time;size:.04;height:0.001" material="color:#f00" position="-0.1 -0.7 -1" id="board"></a-entity>
                  <!--Entity for Winner text-->
                  <a-entity text="text: ;size:.3;height:0.001" material="color:#78ff0f" position="-0.3 0 -1" id="winner"></a-entity>
                </a-entity>               
    </a-scene>
    <!--Aframe scene ends here-->

    <!--JavaScript Starts here-->
    
    <script>
// On-click component created to reload page
AFRAME.registerComponent('on-click', {
init: function () {
this.el.addEventListener('click', function (evt) {
  location.reload();
});
}
});

                  // Maze formation
    var maze;

    // Player body collision with the portal/door & winner display
    var cam = document.getElementById('camera');
    cam.addEventListener('collide', function (e) {
      if(e.detail.body.el.getAttribute('id')=='price'){
        clearInterval(counter);

        var winner = document.getElementById('winner');
        var attr_text = winner.getAttribute('text');
        attr_text.text = "You win!!";
        winner.setAttribute('text', attr_text);
      }
    });


    var seconds = 0;
    var counter;
    
    // Creating a maze array
    function init(width,height){
      clearInterval(counter);
      maze = new Array(parseInt(height));
      for (var i = 0; i < maze.length; i++){
        maze[i] = [].repeat(0, width);
      }

      // Random maze generation 
      buildPath(maze,[0,0]);
      if(typeof QueryString.maze == 'undefined'){
        window.location.hash += '&maze='+LZString.compressToBase64(JSON.stringify(maze));
      }else{
        maze = JSON.parse(LZString.decompressFromBase64(QueryString.maze))
      }
      paintMaze(maze);
      seconds = 0;
      counter = setInterval(function(){
        var board = document.getElementById('board');
        var attr_text = board.getAttribute('text');
        attr_text.text = seconds++;
        board.setAttribute('text', attr_text);
      },1000);
    }

    var width = QueryString.width;
    var height = QueryString.height;
    if(typeof width == 'undefined'){
      width = 18;
    }
    if(typeof height == 'undefined'){
      height = 14;
    }
    init(width,height);


    </script>
   <!--JavaScript ends here-->
  </body>
</html>
